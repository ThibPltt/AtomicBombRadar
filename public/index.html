<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AtomicBombRadar</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <h1>AtomicBombRadar</h1>
    <div id="main-container">
        <div id="map"></div>
        <div id="countries-container">
            <div id="search-container">
                <input type="text" id="search-bar" placeholder="Rechercher une ville...">
                <button id="search-button">Rechercher</button>
                <div class="tab" id="tabs-container">
                    <!-- Les boutons des onglets seront générés dynamiquement -->
                </div>
                <div id="tab-contents-container">
                    <!-- Les contenus des onglets seront générés dynamiquement -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Coordonnées de la carte centrée sur Paris
        var map = L.map('map').setView([48.8566, 2.3522], 13);
        var marker = null;
        var explosionCircle = null;
        var radiationCircle = null;

        // Ajout des tuiles de la carte
        L.tileLayer('/osm/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Ajout d'un marqueur à Paris
        marker = L.marker([48.8566, 2.3522]).addTo(map);
        marker.bindPopup("<b>Paris</b><br>Capitale de la France.").openPopup();

        // Fonction pour rechercher une ville
        document.getElementById('search-button').addEventListener('click', function() {
            var city = document.getElementById('search-bar').value;
            if (city) {
                fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            var location = data[0];
                            map.setView([location.lat, location.lon], 13);
                            if (marker) {
                                map.removeLayer(marker);
                            }
                            marker = L.marker([location.lat, location.lon]).addTo(map);
                            marker.bindPopup(`<b>${location.display_name}</b>`).openPopup();
                        } else {
                            alert('Ville non trouvée.');
                        }
                    })
                    .catch(error => console.error('Erreur lors de la recherche:', error));
            }
        });

        // Fonction pour définir le rayon d'explosion et de radiation
        function setBombRadius(radius, bombName) {
            if (marker) {
                var latLng = marker.getLatLng();

                // Supprimer les cercles existants
                if (explosionCircle) {
                    map.removeLayer(explosionCircle);
                }
                if (radiationCircle) {
                    map.removeLayer(radiationCircle);
                }

                // Ajouter un cercle pour le rayon d'explosion
                explosionCircle = L.circle(latLng, {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.5,
                    radius: radius
                }).addTo(map);

                // Ajouter un cercle pour le rayon de radiation (2x le rayon d'explosion)
                radiationCircle = L.circle(latLng, {
                    color: 'yellow',
                    fillColor: '#ff0',
                    fillOpacity: 0.3,
                    radius: radius * 2
                }).addTo(map);

                // Mettre à jour le popup du marqueur
                marker.bindPopup(`<b>${bombName}</b><br>Rayon d'explosion: ${radius} m`).openPopup();
            }
        }

        // Charger les données des bombes depuis le fichier JSON
        fetch('bombs.json')
            .then(response => response.json())
            .then(data => {
                const tabsContainer = document.getElementById('tabs-container');
                const tabContentsContainer = document.getElementById('tab-contents-container');

                // Parcourir les pays et leurs bombes
                for (const country in data) {
                    // Créer un bouton pour chaque pays
                    const tabButton = document.createElement('button');
                    tabButton.className = 'tablinks';
                    tabButton.textContent = country;
                    tabButton.onclick = (event) => openTab(event, country);
                    tabsContainer.appendChild(tabButton);

                    // Créer un contenu d'onglet pour chaque pays
                    const tabContent = document.createElement('div');
                    tabContent.id = country;
                    tabContent.className = 'tabcontent';

                    data[country].forEach(bomb => {
                        const bombCase = document.createElement('div');
                        bombCase.className = 'bomb-case';
                        bombCase.onclick = () => setBombRadius(bomb.radius, bomb.name);

                        const img = document.createElement('img');
                        img.src = bomb.image;
                        img.alt = bomb.name;

                        const span = document.createElement('span');
                        span.textContent = bomb.name;

                        bombCase.appendChild(img);
                        bombCase.appendChild(span);
                        tabContent.appendChild(bombCase);
                    });

                    tabContentsContainer.appendChild(tabContent);
                }

                // Ouvrir le premier onglet par défaut
                document.getElementsByClassName('tablinks')[0].click();
            })
            .catch(error => console.error('Erreur lors du chargement des bombes:', error));

        // Fonction pour ouvrir les onglets
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script>
</body>
</html>